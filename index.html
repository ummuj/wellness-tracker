<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellness & Exercise Tracker (Static)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --c-dark-blue: #0A2463;
            --c-mid-blue: #3E92CC;
            --c-bright-red: #D8315B;
            --c-green: #3DCC7B;
            --c-white: #FFFFFF;
            --c-light-gray: #f9fafb; 
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-light-gray);
            color: var(--c-dark-blue);
        }
        .card {
            background-color: var(--c-white);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
        }
        .chart-container {
            position: relative;
            height: 250px;
        }
        .list-container {
            max-height: 250px;
            overflow-y: auto;
        }
        .list-container::-webkit-scrollbar {
            width: 6px;
        }
        .list-container::-webkit-scrollbar-thumb {
            background: var(--c-mid-blue);
            border-radius: 10px;
        }
        .list-container::-webkit-scrollbar-track {
            background: var(--c-light-gray);
        }
        .file-input-label {
            cursor: pointer;
            transition: all 0.2s;
        }
        .file-input-label:hover {
            background-color: var(--c-mid-blue);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .input-field {
            @apply w-full p-2 border border-gray-300 rounded-lg focus:ring-[var(--c-mid-blue)] focus:border-[var(--c-mid-blue)];
        }
        .loading-ring {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(10, 36, 99, 0.3);
            border-radius: 50%;
            border-top-color: var(--c-dark-blue);
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f3f4f6;
            border-radius: 8px;
            height: 100%;
            padding: 20px;
            text-align: center;
        }
    </style>
    <script>
        // --- Static Data Storage (using localStorage) ---
        const LS_KEY_METRICS = 'tracker_dailyMetrics';
        const LS_KEY_NUTRITION = 'tracker_nutritionData';
        const LS_KEY_EXERCISE = 'tracker_exerciseData';
        const LS_KEY_WEIGHT = 'tracker_weightHistory';

        // Global Data State
        let activeMealType = 'breakfast';
        let nutritionData = { breakfast: [], lunch: [], dinner: [], snacks: [] };
        let dailyMetrics = { weight: null, calorieGoal: 2000, sleepDuration: null, restingHeartRate: null, notes: '' };
        let exerciseData = [];
        let weightHistory = [];

        // Chart configuration colors
        const chartColors = {
            dark_blue: 'rgb(10, 36, 99)',
            mid_blue: 'rgb(62, 146, 204)',
            bright_red: 'rgb(216, 49, 91)',
            mid_blue_bg: 'rgba(62, 146, 204, 0.2)',
            green: 'rgb(61, 204, 123)',
            green_bg: 'rgba(61, 204, 123, 0.2)',
        };

        // --- Utility Functions ---

        const todayDate = () => new Date().toISOString().slice(0, 10); // YYYY-MM-DD

        function loadState() {
            try {
                const storedMetrics = localStorage.getItem(LS_KEY_METRICS);
                if (storedMetrics) dailyMetrics = JSON.parse(storedMetrics);
                
                const storedNutrition = localStorage.getItem(LS_KEY_NUTRITION);
                if (storedNutrition) nutritionData = JSON.parse(storedNutrition);

                const storedExercise = localStorage.getItem(LS_KEY_EXERCISE);
                if (storedExercise) exerciseData = JSON.parse(storedExercise);
                
                const storedWeight = localStorage.getItem(LS_KEY_WEIGHT);
                if (storedWeight) {
                    weightHistory = JSON.parse(storedWeight);
                    // Ensure unique entries per day, only keeping the latest if duplicates exist
                    const uniqueWeights = {};
                    weightHistory.forEach(w => uniqueWeights[w.date] = w);
                    weightHistory = Object.values(uniqueWeights);
                    weightHistory.sort((a, b) => new Date(a.date) - new Date(b.date));
                }
            } catch (e) {
                console.error("Error loading state from localStorage:", e);
            }
        }

        function saveState() {
            localStorage.setItem(LS_KEY_METRICS, JSON.stringify(dailyMetrics));
            localStorage.setItem(LS_KEY_NUTRITION, JSON.stringify(nutritionData));
            localStorage.setItem(LS_KEY_EXERCISE, JSON.stringify(exerciseData));
            localStorage.setItem(LS_KEY_WEIGHT, JSON.stringify(weightHistory));
            document.getElementById('saveStatus').textContent = 'Saved to local storage.';
            setTimeout(() => document.getElementById('saveStatus').textContent = '', 2000);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // --- Data Handlers - Metrics & Weight ---
        
        window.saveMetrics = () => {
            const date = todayDate();
            
            // Read inputs
            const weight = parseFloat(document.getElementById('weightInput').value) || null;
            const calorieGoal = parseFloat(document.getElementById('calorieGoalInput').value) || 2000;
            const sleepDuration = parseFloat(document.getElementById('sleepDurationInput').value) || null;
            const restingHeartRate = parseFloat(document.getElementById('restingHeartRateInput').value) || null;
            const notes = document.getElementById('notesInput').value.trim();

            // Update dailyMetrics
            dailyMetrics = {
                weight, calorieGoal, sleepDuration, restingHeartRate, notes
            };
            
            // Update weightHistory (if weight is provided)
            if (weight) {
                const existingIndex = weightHistory.findIndex(entry => entry.date === date);
                const newEntry = { date: date, weight: weight };
                
                if (existingIndex !== -1) {
                    weightHistory[existingIndex] = newEntry; // Update existing
                } else {
                    weightHistory.push(newEntry); // Add new
                    weightHistory.sort((a, b) => new Date(a.date) - new Date(b.date)); // Keep sorted
                }
            }
            
            saveState();
            updateMetricsUI();
            updateGoalChart();
            createWeightTrendChart(weightHistory);
        }

        // --- Data Handlers - Exercise ---

        window.handleExerciseInput = (event) => {
            event.preventDefault();

            const form = event.target;
            const activity = form.activityType.value.trim();
            const duration = parseFloat(form.durationMinutes.value);
            const avgHeartRate = parseFloat(form.avgHeartRate.value) || null;

            if (!activity || !duration || duration <= 0) {
                document.getElementById('exerciseStatus').textContent = 'Please enter a valid activity and duration.';
                setTimeout(() => document.getElementById('exerciseStatus').textContent = '', 3000);
                return;
            }

            const entry = {
                id: Date.now(), // Use timestamp as a unique ID
                date: todayDate(),
                activity: activity,
                duration_minutes: duration,
                avg_heart_rate: avgHeartRate,
            };
            
            exerciseData.push(entry);
            saveState();
            form.reset();
            updateExerciseUI();
            document.getElementById('exerciseStatus').textContent = 'Exercise logged successfully!';
            setTimeout(() => document.getElementById('exerciseStatus').textContent = '', 3000);
        }
        
        function updateExerciseUI() {
            const listContainer = document.getElementById('exerciseList');
            listContainer.innerHTML = '';

            const totalDuration = exerciseData.reduce((sum, entry) => sum + entry.duration_minutes, 0);
            document.getElementById('totalDurationDisplay').textContent = `${totalDuration.toFixed(0)} minutes`;

            if (exerciseData.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-gray-500 py-4">No activities logged today.</p>`;
            } else {
                exerciseData.forEach(entry => {
                    const listItem = document.createElement('div');
                    listItem.className = 'flex justify-between items-center py-2 px-3 mb-1 bg-gray-50 rounded-lg border border-gray-200';
                    listItem.innerHTML = `
                        <span class="font-medium text-sm text-[var(--c-dark-blue)]">${entry.activity}</span>
                        <div class="text-right">
                            <span class="text-xs block text-gray-500">${entry.avg_heart_rate ? entry.avg_heart_rate + ' BPM (Avg HR)' : ''}</span>
                            <span class="text-sm text-[var(--c-green)] font-semibold">${entry.duration_minutes.toFixed(0)} mins</span>
                        </div>
                    `;
                    listContainer.appendChild(listItem);
                });
            }
        }


        // --- Data Handlers - Nutrition ---

        /** Saves a new nutrition entry to local state and storage. */
        function saveNutritionEntry(mealType, entryName, calories, protein, carbs, fat) {
            const entry = {
                id: Date.now(),
                date: todayDate(),
                mealType: mealType,
                name: entryName,
                calories: Number(calories) || 0,
                protein_g: Number(protein) || 0,
                carbs_g: Number(carbs) || 0,
                fat_g: Number(fat) || 0,
            };

            if (nutritionData[mealType]) {
                nutritionData[mealType].push(entry);
                saveState();
                updateNutritionUI();
                updateGoalChart();
            }
        }

        // --- AI Simulation (Gemini Vision) ---
        
        window.analyzeFoodPhoto = async (file) => {
            const aiStatusEl = document.getElementById('aiStatus');
            aiStatusEl.innerHTML = '<span class="loading-ring mr-2"></span> Analyzing photo... please wait.';
            
            const mealType = document.getElementById('mealTypeSelectorInput').value;
            
            if (file) {
                 // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1500));
            }

            // Mocked Structured Response (simulating the JSON output)
            const analysis = {
                food_name: "Simulated Chicken & Rice Bowl",
                estimated_calories: 480,
                macros: { 
                    protein_g: 40, 
                    carbs_g: 55, 
                    fat_g: 15 
                }
            };

            try {
                aiStatusEl.textContent = `Analysis complete for ${analysis.food_name}! Logging...`;
                
                saveNutritionEntry(
                    mealType,
                    analysis.food_name,
                    analysis.estimated_calories,
                    analysis.macros.protein_g,
                    analysis.macros.carbs_g,
                    analysis.macros.fat_g
                );

                aiStatusEl.textContent = 'Logged successfully!';
                
            } catch (error) {
                console.error("AI Analysis or Save Error: ", error);
                aiStatusEl.textContent = `Error: ${error.message}`;
            } finally {
                setTimeout(() => aiStatusEl.textContent = 'Ready for next analysis.', 5000);
            }
        }

        /** Handles file selection for photo analysis. */
        window.handleFileSelect = (event) => {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                analyzeFoodPhoto(file);
            } else {
                document.getElementById('aiStatus').textContent = 'Please select a valid image file.';
            }
            event.target.value = ''; 
        }
        
        // --- UI Update and Charting ---

        /** Updates the Weight Summary, Sleep, and RHR display. */
        function updateMetricsUI() {
            // Update inputs with current state
            document.getElementById('weightInput').value = dailyMetrics.weight || '';
            document.getElementById('calorieGoalInput').value = dailyMetrics.calorieGoal || 2000;
            document.getElementById('sleepDurationInput').value = dailyMetrics.sleepDuration || '';
            document.getElementById('restingHeartRateInput').value = dailyMetrics.restingHeartRate || '';
            document.getElementById('notesInput').value = dailyMetrics.notes || '';

            // Update summary display
            const weight = dailyMetrics.weight;
            const sleepDuration = dailyMetrics.sleepDuration;
            const restingHeartRate = dailyMetrics.restingHeartRate; 
            
            document.getElementById('currentWeightDisplay').textContent = weight ? `${weight.toFixed(1)} kg` : 'N/A';
            
            let weightChange = 0;
            if (weightHistory.length >= 2) {
                // Get the last two unique, valid weight entries
                const currentWeight = weightHistory[weightHistory.length - 1].weight;
                const lastWeight = weightHistory[weightHistory.length - 2].weight;
                
                if (currentWeight !== undefined && lastWeight !== undefined) {
                    weightChange = currentWeight - lastWeight;
                }
            }
            
            const weightChangeEl = document.getElementById('weightChangeDisplay');
            if (weightHistory.length < 2) {
                 weightChangeEl.textContent = 'Log more entries for trend.';
                 weightChangeEl.className = 'text-sm font-medium text-gray-500';
            } else {
                 weightChangeEl.textContent = `Change from last entry: ${weightChange.toFixed(1)} kg`;
                 weightChangeEl.className = 'text-sm font-medium ' + (
                    weightChange < 0 ? 'text-green-600' : 
                    (weightChange > 0 ? 'text-red-600' : 'text-gray-600')
                );
            }
            
            document.getElementById('sleepDisplay').textContent = sleepDuration ? `${sleepDuration} hours` : 'N/A';
            document.getElementById('rhrDisplay').textContent = restingHeartRate ? `${restingHeartRate} BPM` : 'N/A';
            document.getElementById('notesDisplay').textContent = dailyMetrics.notes || 'No detailed notes logged.';
        }


        /** Calculates total daily calories. */
        function calculateTotalCalories() {
            let totalCalories = 0;
            Object.values(nutritionData).forEach(mealEntries => {
                mealEntries.forEach(entry => {
                    totalCalories += entry.calories;
                });
            });
            return totalCalories;
        }

        /** Updates the nutrition tracker list and summary based on the current activeMealType. */
        function updateNutritionUI() {
            const totalCalories = calculateTotalCalories();
            const calorieGoal = dailyMetrics.calorieGoal || 2000;
            
            document.getElementById('calorieGoalDisplay').textContent = `${calorieGoal.toFixed(0)} kcal`;

            // 1. Update Active Meal List
            const listContainer = document.getElementById('currentMealList');
            listContainer.innerHTML = ''; 
            const currentMealEntries = nutritionData[activeMealType] || [];
            
            // Update the display title to reflect the selected view
            document.getElementById('mealViewHeader').textContent = `${activeMealType.charAt(0).toUpperCase() + activeMealType.slice(1)} Items`;
            
            if (currentMealEntries.length === 0) {
                listContainer.innerHTML = `<p class="text-center text-gray-500 py-4">No ${activeMealType} logged yet.</p>`;
            } else {
                currentMealEntries.forEach(entry => {
                    const listItem = document.createElement('div');
                    listItem.className = 'flex justify-between items-center py-2 px-3 mb-1 bg-gray-50 rounded-lg border border-gray-200';
                    listItem.innerHTML = `
                        <span class="font-medium text-sm">${entry.name}</span>
                        <span class="text-sm text-gray-600">${entry.calories.toFixed(0)} Cal</span>
                    `;
                    listContainer.appendChild(listItem);
                });
            }

            // 2. Update Total Calorie Count for the whole day
            document.getElementById('totalDailyCalories').textContent = `${totalCalories.toFixed(0)} kcal`;
        }

        let calorieChartInstance = null;
        /** Updates the Goal Progress Chart. */
        function updateGoalChart() {
            const consumed = calculateTotalCalories();
            const goal = dailyMetrics.calorieGoal || 2000;
            const remaining = Math.max(0, goal - consumed);
            const exceeded = consumed > goal ? consumed - goal : 0;
            const remainingForChart = remaining > 0 ? remaining : 0;
            
            const dataPoints = consumed > goal 
                ? [goal, exceeded] 
                : [consumed, remainingForChart];
            
            const labels = consumed > goal 
                ? ['Goal Consumed', 'Exceeded Goal'] 
                : ['Consumed Calories', 'Remaining Goal'];
            
            const colors = consumed > goal 
                ? [chartColors.dark_blue, chartColors.bright_red] 
                : [chartColors.dark_blue, chartColors.mid_blue_bg];

            if (calorieChartInstance) calorieChartInstance.destroy();
            const ctx = document.getElementById('calorieGoalChart').getContext('2d');

            calorieChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: dataPoints,
                        backgroundColor: colors,
                        hoverOffset: 4,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: chartColors.dark_blue, font: { size: 12, family: 'Inter' } } },
                        tooltip: { callbacks: { label: (context) => `${context.label}: ${context.parsed.toFixed(0)} kcal` } }
                    },
                }
            });
            // Update the center text summary
            document.getElementById('calorieSummaryText').innerHTML = `<span class="text-3xl font-bold text-[var(--c-dark-blue)]">${consumed.toFixed(0)}</span> / ${goal.toFixed(0)} kcal`;
        }

        let weightChartInstance = null;
        /** Creates or updates the Weight Trend Chart. */
        function createWeightTrendChart(history) {
            if (weightChartInstance) weightChartInstance.destroy();
            
            const validHistory = history.filter(item => item.weight !== null && item.weight !== undefined);

            const dataPoints = validHistory.map(item => item.weight);
            const labels = validHistory.map(item => new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

            const chartEl = document.getElementById('weightTrendChart');
            const placeholderEl = document.getElementById('weightTrendPlaceholder');

            if (dataPoints.length < 2) {
                 chartEl.classList.add('hidden');
                 placeholderEl.classList.remove('hidden');
                 return;
            } else {
                 chartEl.classList.remove('hidden');
                 placeholderEl.classList.add('hidden');
            }

            const ctx = chartEl.getContext('2d');
            weightChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Weight (kg)',
                        data: dataPoints,
                        fill: true,
                        backgroundColor: chartColors.mid_blue_bg,
                        borderColor: chartColors.mid_blue,
                        tension: 0.2,
                        pointBackgroundColor: chartColors.mid_blue,
                        pointBorderColor: '#fff',
                        pointHoverRadius: 6,
                        pointRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: false, grid: { color: 'rgba(0, 0, 0, 0.05)' } }, x: { grid: { display: false } } }
                }
            });
        }


        // --- Initialisation ---

        /** Changes the meal type being viewed/logged to. */
        window.switchMealType = (mealType) => {
            activeMealType = mealType;
            updateNutritionUI();
        }
        
        /** Handles manual form submission. */
        window.handleManualInput = (event) => {
            event.preventDefault();
            const form = event.target;
            const mealType = document.getElementById('mealTypeSelectorInput').value;
            const name = form.foodName.value.trim();
            const cal = form.calories.value;
            // Macros are not required for manual input but are saved as 0 for consistency
            const protein = 0; 
            const carbs = 0;
            const fat = 0;

            if (name && cal) {
                saveNutritionEntry(mealType, name, cal, protein, carbs, fat);
                form.reset(); 
            }
        }

        function loadStateAndInit() {
            loadState(); // Load data from localStorage
            
            // Initialize all UI components based on loaded state
            updateMetricsUI();
            updateExerciseUI();
            updateNutritionUI();
            updateGoalChart();
            createWeightTrendChart(weightHistory);
            
            // Set the dropdown to the initial active meal type
            document.getElementById('mealTypeSelectorInput').value = activeMealType;

            // Display localStorage notice
             document.getElementById('persistenceNotice').textContent = "Data is saved locally in your browser.";
        }

        window.onload = loadStateAndInit;

    </script>
</head>
<body class="p-4 md:p-8">
    <header class="mb-8">
        <h1 class="text-3xl font-bold text-center text-[var(--c-dark-blue)]">Wellness & Exercise Tracker</h1>
        <p id="persistenceNotice" class="text-center text-xs mt-2 text-gray-500 italic"></p>
        <p id="saveStatus" class="text-center text-xs mt-1 text-green-600 font-semibold"></p>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
        
        <!-- COLUMN 1: Daily Metrics and Calorie Chart -->
        <section class="lg:col-span-1 space-y-6">
            
            <!-- Daily Metrics Input and Save -->
            <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-[var(--c-dark-blue)]">Today's Health Metrics</h2>
                <div class="space-y-4">
                    <!-- Weight Input -->
                    <div>
                        <label for="weightInput" class="block text-sm font-medium text-gray-700 mb-1">Current Weight (kg)</label>
                        <input type="number" id="weightInput" placeholder="e.g. 75.5" min="0" step="0.1" 
                            class="input-field" onchange="saveMetrics()">
                    </div>
                    <!-- Calorie Goal Input -->
                    <div>
                        <label for="calorieGoalInput" class="block text-sm font-medium text-gray-700 mb-1">Daily Calorie Goal (kcal)</label>
                        <input type="number" id="calorieGoalInput" placeholder="e.g. 2000" min="500" value="2000"
                            class="input-field" onchange="saveMetrics()">
                    </div>
                    <!-- Sleep Duration Input -->
                    <div>
                        <label for="sleepDurationInput" class="block text-sm font-medium text-gray-700 mb-1">Sleep Duration (hours)</label>
                        <input type="number" id="sleepDurationInput" placeholder="e.g. 7.5" min="0" max="24" step="0.5"
                            class="input-field" onchange="saveMetrics()">
                    </div>
                    <!-- Resting Heart Rate Input -->
                    <div>
                        <label for="restingHeartRateInput" class="block text-sm font-medium text-gray-700 mb-1">Resting Heart Rate (BPM)</label>
                        <input type="number" id="restingHeartRateInput" placeholder="e.g. 60" min="30" max="150" 
                            class="input-field" onchange="saveMetrics()">
                    </div>
                    <!-- Notes Input -->
                    <div>
                        <label for="notesInput" class="block text-sm font-medium text-gray-700 mb-1">Daily Notes/How I feel</label>
                        <textarea id="notesInput" rows="2" placeholder="e.g. Had a great workout today, but felt tired in the afternoon."
                            class="input-field" onchange="saveMetrics()"></textarea>
                    </div>
                    <button onclick="saveMetrics()" class="w-full bg-[var(--c-dark-blue)] text-white p-2 rounded-lg font-semibold hover:bg-[var(--c-mid-blue)] transition duration-200">
                        <i class="fas fa-save mr-2"></i> Save Daily Metrics
                    </button>
                    <p id="metricStatus" class="text-center text-sm mt-2 text-gray-500"></p>
                </div>
            </div>

            <!-- Calorie Goal Chart -->
            <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-[var(--c-dark-blue)]">Calorie Progress</h2>
                <div class="chart-container relative">
                    <canvas id="calorieGoalChart"></canvas>
                    <div id="calorieSummaryText" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <span class="text-xl font-bold text-gray-400">Loading...</span>
                    </div>
                </div>
                <div class="text-center mt-3 text-sm text-gray-600">Goal: <span id="calorieGoalDisplay" class="font-semibold text-[var(--c-mid-blue)]">2000 kcal</span></div>
                <div class="mt-4 p-3 rounded-lg border-l-4 border-[var(--c-dark-blue)] bg-[var(--c-dark-blue)]/10 text-[var(--c-dark-blue)] font-bold flex justify-between">
                    <span>Total Daily Calories:</span>
                    <span id="totalDailyCalories">0 kcal</span>
                </div>
            </div>

            <!-- Sleep, RHR & Notes Summary -->
             <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-[var(--c-dark-blue)]">Daily Summary</h2>
                <div class="space-y-3">
                    <!-- Resting Heart Rate Display -->
                    <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-[var(--c-bright-red)] flex justify-between items-center">
                        <span class="font-medium text-gray-700 flex items-center"><i class="fas fa-heart mr-2 text-[var(--c-bright-red)]"></i> Resting Heart Rate:</span>
                        <span id="rhrDisplay" class="font-semibold text-[var(--c-dark-blue)]">N/A</span>
                    </div>
                    <!-- Sleep Duration Display -->
                    <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-[var(--c-green)] flex justify-between items-center">
                        <span class="font-medium text-gray-700 flex items-center"><i class="fas fa-moon mr-2 text-[var(--c-green)]"></i> Sleep Duration:</span>
                        <span id="sleepDisplay" class="font-semibold text-[var(--c-dark-blue)]">N/A</span>
                    </div>
                     <!-- Notes Display -->
                     <div class="p-3 bg-gray-50 rounded-lg text-sm italic text-gray-600 border-l-4 border-[var(--c-mid-blue)]">
                        <h4 class="font-semibold text-base mb-1 text-[var(--c-dark-blue)]">Notes:</h4>
                        <p id="notesDisplay">No detailed notes logged.</p>
                    </div>
                </div>
            </div>

        </section>

        <!-- COLUMN 2: Nutrition Input and List -->
        <section class="lg:col-span-1 card">
            <h2 class="text-2xl font-semibold mb-4 text-[var(--c-dark-blue)]">Daily Nutrition Tracker</h2>
            
            <!-- Meal Type Dropdown Selector -->
            <div class="mb-6">
                <label for="mealTypeSelectorInput" class="block text-sm font-medium text-gray-700 mb-1">Select Meal Type</label>
                <select id="mealTypeSelectorInput" onchange="switchMealType(this.value)" class="input-field">
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                    <option value="snacks">Snacks</option>
                </select>
            </div>

            <div id="mealContent">
                <!-- Input Forms -->
                <div class="space-y-4 mb-6">
                    <!-- Manual Input Form -->
                    <form onsubmit="handleManualInput(event)" class="card p-4 border border-gray-200">
                        <h4 class="font-semibold text-lg mb-3 flex items-center text-[var(--c-mid-blue)]"><i class="fas fa-keyboard mr-2"></i> Manual Entry (Calories)</h4>
                        <input type="text" id="foodName" name="foodName" placeholder="Food name (e.g., Oatmeal)" required
                            class="input-field mb-2">
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <input type="number" id="calories" name="calories" placeholder="Calories (kcal)*" required min="1"
                                class="input-field col-span-2">
                        </div>
                        <button type="submit" class="w-full bg-[var(--c-dark-blue)] text-white p-2 rounded-lg font-semibold hover:bg-[var(--c-mid-blue)] transition duration-200">
                            Log Meal
                        </button>
                    </form>

                    <!-- Photo Analysis Input -->
                    <div class="card p-4 border border-gray-200 flex flex-col justify-between">
                        <h4 class="font-semibold text-lg mb-3 flex items-center text-[var(--c-mid-blue)]"><i class="fas fa-camera mr-2"></i> Analyze Food Photo (Simulated AI)</h4>
                        <p class="text-sm text-gray-600 mb-4">Upload a photo to see a simulated AI analysis and logging process.</p>
                        
                        <input type="file" id="photoInput" accept="image/*" onchange="handleFileSelect(event)" class="hidden">
                        <label for="photoInput" id="photoLabel" class="file-input-label text-center bg-[var(--c-mid-blue)] text-white p-3 rounded-lg font-semibold cursor-pointer hover:bg-[var(--c-mid-blue)]/80 transition duration-200">
                            <i class="fas fa-cloud-upload-alt mr-2"></i> Select Image
                        </label>
                        
                        <p id="aiStatus" class="mt-3 text-center text-sm text-gray-500 italic">Ready for next analysis.</p>
                    </div>
                </div>

                <!-- Logged Meals List -->
                <h4 class="text-xl font-semibold mb-3 mt-6 text-[var(--c-dark-blue)]" id="mealViewHeader">Logged Items</h4>
                <div id="currentMealList" class="list-container space-y-2">
                    <p class="text-center text-gray-500 py-4">No data loaded.</p>
                </div>
            </div>
        </section>

        <!-- COLUMN 3: Exercise Tracker and Weight Trend Chart -->
        <section class="lg:col-span-1 space-y-6">
            
            <!-- Exercise Tracker -->
            <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-[var(--c-dark-blue)]">Daily Exercise Tracker</h2>
                <form onsubmit="handleExerciseInput(event)" class="space-y-3 p-4 bg-gray-50 rounded-lg border border-gray-200 mb-4">
                    <h4 class="font-semibold text-lg flex items-center text-[var(--c-green)]"><i class="fas fa-running mr-2"></i> Log Activity</h4>
                    
                    <div>
                        <label for="activityType" class="block text-sm font-medium text-gray-700 mb-1">Activity Type</label>
                        <select id="activityType" name="activityType" required class="input-field">
                            <option value="">-- Select Activity --</option>
                            <option value="Running">Running</option>
                            <option value="Weight Lifting">Weight Lifting</option>
                            <option value="Cycling">Cycling</option>
                            <option value="Walking">Walking</option>
                            <option value="Yoga">Yoga / Stretching</option>
                            <option value="Swimming">Swimming</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="durationMinutes" class="block text-sm font-medium text-gray-700 mb-1">Duration (minutes)*</label>
                        <input type="number" id="durationMinutes" name="durationMinutes" placeholder="e.g. 45" required min="1"
                            class="input-field">
                    </div>

                    <!-- Average Heart Rate Input -->
                    <div>
                        <label for="avgHeartRate" class="block text-sm font-medium text-gray-700 mb-1">Average Heart Rate (BPM)</label>
                        <input type="number" id="avgHeartRate" name="avgHeartRate" placeholder="e.g. 140 (Optional)" min="50" max="220"
                            class="input-field">
                    </div>

                    <button type="submit" class="w-full bg-[var(--c-green)] text-white p-2 rounded-lg font-semibold hover:bg-[var(--c-green)]/90 transition duration-200">
                        Log Exercise
                    </button>
                    <p id="exerciseStatus" class="text-center text-sm mt-2 text-gray-500"></p>
                </form>

                <!-- Exercise List -->
                <h4 class="text-xl font-semibold mb-3 mt-6 text-[var(--c-dark-blue)]">Logged Activities</h4>
                <div id="exerciseList" class="list-container space-y-2">
                    <p class="text-center text-gray-500 py-4">No data loaded.</p>
                </div>
                
                <div class="mt-4 p-3 rounded-lg border-l-4 border-[var(--c-green)] bg-[var(--c-green)]/10 text-[var(--c-dark-blue)] font-bold flex justify-between">
                    <span>Total Activity Duration:</span>
                    <span id="totalDurationDisplay">0 minutes</span>
                </div>
            </div>

            <!-- Weight Trend Chart -->
            <div class="card">
                <h2 class="text-xl font-semibold mb-4 text-[var(--c-dark-blue)]">Weight Trend</h2>
                <div class="chart-container">
                    <canvas id="weightTrendChart" class=""></canvas>
                    <div id="weightTrendPlaceholder" class="placeholder">
                        <i class="fas fa-chart-line text-4xl mb-2 text-gray-400"></i>
                        <p class="italic text-sm">Log at least two weight entries to see the trend.</p>
                        <p class="text-xs mt-1 text-gray-500">Weight is recorded when saving Daily Metrics.</p>
                    </div>
                </div>
                <div class="text-center mt-3 text-sm border-t pt-2">
                    <span class="font-bold text-[var(--c-dark-blue)]">Current Weight: </span><span id="currentWeightDisplay" class="font-bold text-[var(--c-mid-blue)]">N/A</span>
                    <span id="weightChangeDisplay" class="block text-xs mt-1 text-gray-600">Loading...</span>
                </div>
            </div>

        </section>

    </main>

</body>
</html>